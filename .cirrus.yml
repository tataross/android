task:
    container:
        image: cirrusci/android-sdk:30
        kvm: true
    script: |
        echo y | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --install system-images\;android-30\;google_apis\;x86_64
        echo no | $ANDROID_HOME/cmdline-tools/latest/bin/avdmanager create avd -f -n android -k system-images\;android-30\;google_apis\;x86_64
        $ANDROID_HOME/emulator/emulator -avd android -no-window -gpu swiftshader_indirect -no-snapshot -noaudio -no-boot-anim -memory 4096 &
        $ANDROID_HOME/platform-tools/adb wait-for-device
        while [[ $($ANDROID_HOME/platform-tools/adb exec-out getprop sys.boot_completed) != 1 ]]
        do
            sleep 30
        done
        $ANDROID_HOME/platform-tools/adb exec-out getprop sys.boot_completed
        $ANDROID_HOME/platform-tools/adb install cashzine.apk
        $ANDROID_HOME/platform-tools/adb exec-out 'am start -n com.sky.sea.cashzine/com.sky.sea.home.main.MainActivity'
        sleep 30
        $ANDROID_HOME/platform-tools/adb exec-out 'screencap -p' > t.png
    artifacts:
        path: t.png
